#!/bin/sh -e
# ecs grepper
ecs="$NEXTCLOUD/FTT/Deltapeak Daten/logs/ecs"
command cd "$ecs"
id=$(grep -i "$1" cu_customers_nobreaks.csv cu_products.csv | cut -d'"' -f4 | sort | uniq | paste -s -d'|' - )
idmatch="^($id)$"
mlr --csv --allow-ragged-csv-input --headerless-csv-output filter "\$cid =~ \"$idmatch\"" cu_customers_nobreaks.csv
unbuffer mlr --csv --allow-ragged-csv-input filter "\$cid =~ \"$idmatch\"" then cut -f product cu_products.csv | sort | uniq
highlight invoices
mlr --csv --allow-ragged-csv-input --headerless-csv-output --implicit-csv-header filter "\$2 =~ \"$idmatch\"" then cut -o -f 2,5,6,4 cu_invoicelineitems_nobreaks.csv |
    tac | sort -u -t '(' -k 1,1
